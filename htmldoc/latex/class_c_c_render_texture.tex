\hypertarget{class_c_c_render_texture}{\section{C\-C\-Render\-Texture Class Reference}
\label{class_c_c_render_texture}\index{C\-C\-Render\-Texture@{C\-C\-Render\-Texture}}
}


{\ttfamily \#import $<$C\-C\-Render\-Texture.\-h$>$}

Inheritance diagram for C\-C\-Render\-Texture\-:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=3.000000cm]{class_c_c_render_texture}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
(id) -\/ \hyperlink{class_c_c_render_texture_a77581a363d799f8809e41af16b065430}{init\-With\-Width\-:height\-:pixel\-Format\-:}
\item 
(id) -\/ \hyperlink{class_c_c_render_texture_abec7e1e6f1d8364ede1ec35b80e8676b}{init\-With\-Width\-:height\-:pixel\-Format\-:depth\-Stencil\-Format\-:}
\item 
(void) -\/ \hyperlink{class_c_c_render_texture_a6ff1e0f1170a671213fa2318fe2cf9c2}{begin}
\item 
(void) -\/ \hyperlink{class_c_c_render_texture_a3f4c27a273867fccdba169c229c91d25}{begin\-With\-Clear\-:g\-:b\-:a\-:}
\item 
(void) -\/ \hyperlink{class_c_c_render_texture_a597c8f5c870d1e3ac01ec59ca116eaa8}{begin\-With\-Clear\-:g\-:b\-:a\-:depth\-:}
\item 
(void) -\/ \hyperlink{class_c_c_render_texture_abe5bc47d733370376b72b95f76b49b1b}{begin\-With\-Clear\-:g\-:b\-:a\-:depth\-:stencil\-:}
\item 
(void) -\/ \hyperlink{class_c_c_render_texture_a79e67a9ab6e86f790466d46ec20c7a7e}{end}
\item 
(void) -\/ \hyperlink{class_c_c_render_texture_a9be1084ec3e9296b555f3c970670aa1f}{clear\-:g\-:b\-:a\-:}
\item 
(void) -\/ \hyperlink{class_c_c_render_texture_ab970c383f371252cc9f016296189bbb5}{clear\-Depth\-:}
\item 
(void) -\/ \hyperlink{class_c_c_render_texture_a7cd182ca15a0c73135a2056af3bbe9e4}{clear\-Stencil\-:}
\item 
\hypertarget{class_c_c_render_texture_a1235f6cd1189581d0edca90a84737883}{(C\-G\-Image\-Ref) -\/ {\bfseries new\-C\-G\-Image}}\label{class_c_c_render_texture_a1235f6cd1189581d0edca90a84737883}

\item 
(B\-O\-O\-L) -\/ \hyperlink{class_c_c_render_texture_a6c6c723493a1ec9578b2ca4f27774ee7}{save\-To\-File\-:}
\item 
(B\-O\-O\-L) -\/ \hyperlink{class_c_c_render_texture_aad1bc8417cce99a3d936edb4e1a302b1}{save\-To\-File\-:format\-:}
\item 
\hypertarget{class_c_c_render_texture_a03397b4a3c463c0f96dd11770e3a7305}{(B\-O\-O\-L) -\/ {\bfseries save\-Buffer\-:}}\label{class_c_c_render_texture_a03397b4a3c463c0f96dd11770e3a7305}

\item 
\hypertarget{class_c_c_render_texture_a3ee9ad3c82cacb66ddf995ebe8dbf361}{(B\-O\-O\-L) -\/ {\bfseries save\-Buffer\-:format\-:}}\label{class_c_c_render_texture_a3ee9ad3c82cacb66ddf995ebe8dbf361}

\item 
\hypertarget{class_c_c_render_texture_a14db6c0d5295587f64f38d08a5570634}{(N\-S\-Data $\ast$) -\/ {\bfseries get\-U\-I\-Image\-As\-Data\-From\-Buffer\-:}}\label{class_c_c_render_texture_a14db6c0d5295587f64f38d08a5570634}

\end{DoxyCompactItemize}
\subsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
(id) + \hyperlink{class_c_c_render_texture_ae93eca7af88866612ea3eba0dc580e9a}{render\-Texture\-With\-Width\-:height\-:pixel\-Format\-:depth\-Stencil\-Format\-:}
\item 
(id) + \hyperlink{class_c_c_render_texture_a6f38823a12f4eaab8246ef55c66fea81}{render\-Texture\-With\-Width\-:height\-:pixel\-Format\-:}
\item 
(id) + \hyperlink{class_c_c_render_texture_a7fd1516f97823568c33872227a859336}{render\-Texture\-With\-Width\-:height\-:}
\end{DoxyCompactItemize}
\subsection*{Protected Attributes}
\begin{DoxyCompactItemize}
\item 
\hypertarget{class_c_c_render_texture_ab8b54b6da90c41c3ef739c843de02525}{G\-Luint {\bfseries fbo\-\_\-}}\label{class_c_c_render_texture_ab8b54b6da90c41c3ef739c843de02525}

\item 
\hypertarget{class_c_c_render_texture_ae10ffacf207c2fba6fff361ec44f80d0}{G\-Luint {\bfseries depth\-Render\-Bufffer\-\_\-}}\label{class_c_c_render_texture_ae10ffacf207c2fba6fff361ec44f80d0}

\item 
\hypertarget{class_c_c_render_texture_a00f05afd78c12d9b7c234fea47bf7571}{G\-Lint {\bfseries old\-F\-B\-O\-\_\-}}\label{class_c_c_render_texture_a00f05afd78c12d9b7c234fea47bf7571}

\item 
\hypertarget{class_c_c_render_texture_a364cddb0ee9c991fc634667fc8617a78}{\hyperlink{class_c_c_texture2_d}{C\-C\-Texture2\-D} $\ast$ {\bfseries texture\-\_\-}}\label{class_c_c_render_texture_a364cddb0ee9c991fc634667fc8617a78}

\item 
\hypertarget{class_c_c_render_texture_a18c5eac90b8aff74c80ab0c5e943238d}{\hyperlink{class_c_c_sprite}{C\-C\-Sprite} $\ast$ {\bfseries sprite\-\_\-}}\label{class_c_c_render_texture_a18c5eac90b8aff74c80ab0c5e943238d}

\item 
\hypertarget{class_c_c_render_texture_adc5ca48e552dee2ce2160d16c903a2b0}{G\-Lenum {\bfseries pixel\-Format\-\_\-}}\label{class_c_c_render_texture_adc5ca48e552dee2ce2160d16c903a2b0}

\item 
\hypertarget{class_c_c_render_texture_abd5fb554d4ca0e41cc53053d7f358ef3}{G\-Lbitfield {\bfseries clear\-Flags\-\_\-}}\label{class_c_c_render_texture_abd5fb554d4ca0e41cc53053d7f358ef3}

\item 
\hypertarget{class_c_c_render_texture_a52ed9a9fdf3432ef79c78fb9796f34d8}{\hyperlink{cc_types_8h_aecc18290defe020343f1d7bb2ee73145}{cc\-Color4\-F} {\bfseries clear\-Color\-\_\-}}\label{class_c_c_render_texture_a52ed9a9fdf3432ef79c78fb9796f34d8}

\item 
\hypertarget{class_c_c_render_texture_a86909b6a055b503552c152d93144b19e}{G\-Lclampf {\bfseries clear\-Depth\-\_\-}}\label{class_c_c_render_texture_a86909b6a055b503552c152d93144b19e}

\item 
\hypertarget{class_c_c_render_texture_adc22d39ac3c15e19cd5e83edb4fd12d8}{G\-Lint {\bfseries clear\-Stencil\-\_\-}}\label{class_c_c_render_texture_adc22d39ac3c15e19cd5e83edb4fd12d8}

\item 
\hypertarget{class_c_c_render_texture_a5de9a5e87fc4b9439ab495ef834ab2e8}{B\-O\-O\-L {\bfseries auto\-Draw\-\_\-}}\label{class_c_c_render_texture_a5de9a5e87fc4b9439ab495ef834ab2e8}

\end{DoxyCompactItemize}
\subsection*{Properties}
\begin{DoxyCompactItemize}
\item 
\hyperlink{class_c_c_sprite}{C\-C\-Sprite} $\ast$ \hyperlink{class_c_c_render_texture_a1e77dcd25e60ceb47d423854eab9c2b7}{sprite}
\item 
G\-Lbitfield \hyperlink{class_c_c_render_texture_af0a421c5fee6668cbfbb8386d002af41}{clear\-Flags}
\item 
\hyperlink{cc_types_8h_aecc18290defe020343f1d7bb2ee73145}{cc\-Color4\-F} \hyperlink{class_c_c_render_texture_acd634a88dca082fc15cec37b06aac438}{clear\-Color}
\item 
G\-Lclampf \hyperlink{class_c_c_render_texture_af79356a17a6760f9f6167d5444cf6b77}{clear\-Depth}
\item 
G\-Lint \hyperlink{class_c_c_render_texture_a715880e5dc695f243e3ce08b3f8dd09d}{clear\-Stencil}
\item 
B\-O\-O\-L \hyperlink{class_c_c_render_texture_a74d13404d368796b39f69f320faee52b}{auto\-Draw}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
\hyperlink{class_c_c_render_texture}{C\-C\-Render\-Texture} is a generic rendering target. To render things into it, simply construct a render target, call begin on it, call visit on any cocos2d scenes or objects to render them, and call end. For convenience, render texture adds a sprite as its display child with the results, so you can simply add the render texture to your scene and treat it like any other \hyperlink{class_c_c_node}{C\-C\-Node}. There are also functions for saving the render texture to disk in P\-N\-G or J\-P\-G format.

\begin{DoxySince}{Since}
v0.\-8.\-1 
\end{DoxySince}


\subsection{Member Function Documentation}
\hypertarget{class_c_c_render_texture_a6ff1e0f1170a671213fa2318fe2cf9c2}{\index{C\-C\-Render\-Texture@{C\-C\-Render\-Texture}!begin@{begin}}
\index{begin@{begin}!CCRenderTexture@{C\-C\-Render\-Texture}}
\subsubsection[{begin}]{\setlength{\rightskip}{0pt plus 5cm}-\/ (void) {\bf begin} 
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
}}\label{class_c_c_render_texture_a6ff1e0f1170a671213fa2318fe2cf9c2}
starts grabbing 

Referenced by clear\-Depth\-:.


\begin{DoxyCode}
{
        CCDirector *director = [CCDirector sharedDirector];
        
        // Save the current matrix
        kmGLPushMatrix();

        CGSize texSize = [texture_ contentSizeInPixels];


        // Calculate the adjustment ratios based on the old and new projections
        CGSize size = [director winSizeInPixels];
        float widthRatio = size.width / texSize.width;
        float heightRatio = size.height / texSize.height;


        // Adjust the orthographic projection and viewport
        glViewport(0, 0, texSize.width, texSize.height );

        kmMat4 orthoMatrix;
        kmMat4OrthographicProjection(&orthoMatrix, (float)-1.0 / widthRatio,  (
      float)1.0 / widthRatio,
                                                                 (float)-1.0 / 
      heightRatio, (float)1.0 / heightRatio, -1,1 );
        kmGLMultMatrix(&orthoMatrix);

        glGetIntegerv(GL_FRAMEBUFFER_BINDING, &oldFBO_);
        glBindFramebuffer(GL_FRAMEBUFFER, fbo_);
}
\end{DoxyCode}
\hypertarget{class_c_c_render_texture_a3f4c27a273867fccdba169c229c91d25}{\index{C\-C\-Render\-Texture@{C\-C\-Render\-Texture}!begin\-With\-Clear\-:g\-:b\-:a\-:@{begin\-With\-Clear\-:g\-:b\-:a\-:}}
\index{begin\-With\-Clear\-:g\-:b\-:a\-:@{begin\-With\-Clear\-:g\-:b\-:a\-:}!CCRenderTexture@{C\-C\-Render\-Texture}}
\subsubsection[{begin\-With\-Clear\-:g\-:b\-:a\-:}]{\setlength{\rightskip}{0pt plus 5cm}-\/ (void) begin\-With\-Clear\-: 
\begin{DoxyParamCaption}
\item[{(float)}]{r}
\item[{g:(float)}]{g}
\item[{b:(float)}]{b}
\item[{a:(float)}]{a}
\end{DoxyParamCaption}
}}\label{class_c_c_render_texture_a3f4c27a273867fccdba169c229c91d25}
starts rendering to the texture while clearing the texture first. This is more efficient then calling -\/clear first and then -\/begin 

Referenced by clear\-:g\-:b\-:a\-:.


\begin{DoxyCode}
                     :(float)r g:(float)g b:(float)b a:(float)a
{
        [self beginWithClear:r g:g b:b a:a depth:0 stencil:0 flags:
      GL_COLOR_BUFFER_BIT];
}
\end{DoxyCode}
\hypertarget{class_c_c_render_texture_a597c8f5c870d1e3ac01ec59ca116eaa8}{\index{C\-C\-Render\-Texture@{C\-C\-Render\-Texture}!begin\-With\-Clear\-:g\-:b\-:a\-:depth\-:@{begin\-With\-Clear\-:g\-:b\-:a\-:depth\-:}}
\index{begin\-With\-Clear\-:g\-:b\-:a\-:depth\-:@{begin\-With\-Clear\-:g\-:b\-:a\-:depth\-:}!CCRenderTexture@{C\-C\-Render\-Texture}}
\subsubsection[{begin\-With\-Clear\-:g\-:b\-:a\-:depth\-:}]{\setlength{\rightskip}{0pt plus 5cm}-\/ (void) begin\-With\-Clear\-: 
\begin{DoxyParamCaption}
\item[{(float)}]{r}
\item[{g:(float)}]{g}
\item[{b:(float)}]{b}
\item[{a:(float)}]{a}
\item[{depth:(float)}]{depth\-Value}
\end{DoxyParamCaption}
}}\label{class_c_c_render_texture_a597c8f5c870d1e3ac01ec59ca116eaa8}
starts rendering to the texture while clearing the texture first. This is more efficient then calling -\/clear first and then -\/begin 
\begin{DoxyCode}
                     :(float)r g:(float)g b:(float)b a:(float)a depth:(float)
      depthValue
{
        [self beginWithClear:r g:g b:b a:a depth:depthValue stencil:0 flags:
      GL_COLOR_BUFFER_BIT|GL_DEPTH_BUFFER_BIT];
}
\end{DoxyCode}
\hypertarget{class_c_c_render_texture_abe5bc47d733370376b72b95f76b49b1b}{\index{C\-C\-Render\-Texture@{C\-C\-Render\-Texture}!begin\-With\-Clear\-:g\-:b\-:a\-:depth\-:stencil\-:@{begin\-With\-Clear\-:g\-:b\-:a\-:depth\-:stencil\-:}}
\index{begin\-With\-Clear\-:g\-:b\-:a\-:depth\-:stencil\-:@{begin\-With\-Clear\-:g\-:b\-:a\-:depth\-:stencil\-:}!CCRenderTexture@{C\-C\-Render\-Texture}}
\subsubsection[{begin\-With\-Clear\-:g\-:b\-:a\-:depth\-:stencil\-:}]{\setlength{\rightskip}{0pt plus 5cm}-\/ (void) begin\-With\-Clear\-: 
\begin{DoxyParamCaption}
\item[{(float)}]{r}
\item[{g:(float)}]{g}
\item[{b:(float)}]{b}
\item[{a:(float)}]{a}
\item[{depth:(float)}]{depth\-Value}
\item[{stencil:(int)}]{stencil\-Value}
\end{DoxyParamCaption}
}}\label{class_c_c_render_texture_abe5bc47d733370376b72b95f76b49b1b}
starts rendering to the texture while clearing the texture first. This is more efficient then calling -\/clear first and then -\/begin 
\begin{DoxyCode}
                     :(float)r g:(float)g b:(float)b a:(float)a depth:(float)
      depthValue stencil:(int)stencilValue
{
        [self beginWithClear:r g:g b:b a:a depth:depthValue stencil:
      stencilValue flags:GL_COLOR_BUFFER_BIT|GL_DEPTH_BUFFER_BIT|GL_STENCIL_BUFFER_BIT];
}
\end{DoxyCode}
\hypertarget{class_c_c_render_texture_a9be1084ec3e9296b555f3c970670aa1f}{\index{C\-C\-Render\-Texture@{C\-C\-Render\-Texture}!clear\-:g\-:b\-:a\-:@{clear\-:g\-:b\-:a\-:}}
\index{clear\-:g\-:b\-:a\-:@{clear\-:g\-:b\-:a\-:}!CCRenderTexture@{C\-C\-Render\-Texture}}
\subsubsection[{clear\-:g\-:b\-:a\-:}]{\setlength{\rightskip}{0pt plus 5cm}-\/ (void) clear\-: 
\begin{DoxyParamCaption}
\item[{(float)}]{r}
\item[{g:(float)}]{g}
\item[{b:(float)}]{b}
\item[{a:(float)}]{a}
\end{DoxyParamCaption}
}}\label{class_c_c_render_texture_a9be1084ec3e9296b555f3c970670aa1f}
clears the texture with a color 
\begin{DoxyCode}
            :(float)r g:(float)g b:(float)b a:(float)a
{
        [self beginWithClear:r g:g b:b a:a];
        [self end];
}
\end{DoxyCode}
\hypertarget{class_c_c_render_texture_ab970c383f371252cc9f016296189bbb5}{\index{C\-C\-Render\-Texture@{C\-C\-Render\-Texture}!clear\-Depth\-:@{clear\-Depth\-:}}
\index{clear\-Depth\-:@{clear\-Depth\-:}!CCRenderTexture@{C\-C\-Render\-Texture}}
\subsubsection[{clear\-Depth\-:}]{\setlength{\rightskip}{0pt plus 5cm}-\/ (void) {\bf clear\-Depth\-:} 
\begin{DoxyParamCaption}
\item[{(float)}]{depth\-Value}
\end{DoxyParamCaption}
}}\label{class_c_c_render_texture_ab970c383f371252cc9f016296189bbb5}
clears the texture with a specified depth value save old depth value 
\begin{DoxyCode}
                  :(float)depthValue
{
        [self begin];
        GLfloat depthClearValue;
        glGetFloatv(GL_DEPTH_CLEAR_VALUE, &depthClearValue);

        glClearDepth(depthValue);
        glClear(GL_DEPTH_BUFFER_BIT);

        // restore clear color
        glClearDepth(depthClearValue);
        [self end];
}
\end{DoxyCode}
\hypertarget{class_c_c_render_texture_a7cd182ca15a0c73135a2056af3bbe9e4}{\index{C\-C\-Render\-Texture@{C\-C\-Render\-Texture}!clear\-Stencil\-:@{clear\-Stencil\-:}}
\index{clear\-Stencil\-:@{clear\-Stencil\-:}!CCRenderTexture@{C\-C\-Render\-Texture}}
\subsubsection[{clear\-Stencil\-:}]{\setlength{\rightskip}{0pt plus 5cm}-\/ (void) {\bf clear\-Stencil\-:} 
\begin{DoxyParamCaption}
\item[{(int)}]{stencil\-Value}
\end{DoxyParamCaption}
}}\label{class_c_c_render_texture_a7cd182ca15a0c73135a2056af3bbe9e4}
clears the texture with a specified stencil value 
\begin{DoxyCode}
                    :(int)stencilValue
{
        // save old stencil value
        int stencilClearValue;
        glGetIntegerv(GL_STENCIL_CLEAR_VALUE, &stencilClearValue);

        glClearStencil(stencilValue);
        glClear(GL_STENCIL_BUFFER_BIT);

        // restore clear color
        glClearStencil(stencilClearValue);
}
\end{DoxyCode}
\hypertarget{class_c_c_render_texture_a79e67a9ab6e86f790466d46ec20c7a7e}{\index{C\-C\-Render\-Texture@{C\-C\-Render\-Texture}!end@{end}}
\index{end@{end}!CCRenderTexture@{C\-C\-Render\-Texture}}
\subsubsection[{end}]{\setlength{\rightskip}{0pt plus 5cm}-\/ (void) {\bf end} 
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
}}\label{class_c_c_render_texture_a79e67a9ab6e86f790466d46ec20c7a7e}
ends grabbing 

Referenced by clear\-:g\-:b\-:a\-:, and clear\-Depth\-:.


\begin{DoxyCode}
{
        CCDirector *director = [CCDirector sharedDirector];
        
        glBindFramebuffer(GL_FRAMEBUFFER, oldFBO_);

        kmGLPopMatrix();

        CGSize size = [director winSizeInPixels];

        // restore viewport
        glViewport(0, 0, size.width * CC_CONTENT_SCALE_FACTOR(), size.height * 
      CC_CONTENT_SCALE_FACTOR() );

        // special viewport for 3d projection + retina display
        if ( director.projection == kCCDirectorProjection3D && 
      CC_CONTENT_SCALE_FACTOR() != 1 )
                glViewport(-size.width/2, -size.height/2, size.width * 
      CC_CONTENT_SCALE_FACTOR(), size.height * CC_CONTENT_SCALE_FACTOR() );
        
        [director setProjection:director.projection];   
}
\end{DoxyCode}
\hypertarget{class_c_c_render_texture_a77581a363d799f8809e41af16b065430}{\index{C\-C\-Render\-Texture@{C\-C\-Render\-Texture}!init\-With\-Width\-:height\-:pixel\-Format\-:@{init\-With\-Width\-:height\-:pixel\-Format\-:}}
\index{init\-With\-Width\-:height\-:pixel\-Format\-:@{init\-With\-Width\-:height\-:pixel\-Format\-:}!CCRenderTexture@{C\-C\-Render\-Texture}}
\subsubsection[{init\-With\-Width\-:height\-:pixel\-Format\-:}]{\setlength{\rightskip}{0pt plus 5cm}-\/ (id) init\-With\-Width\-: 
\begin{DoxyParamCaption}
\item[{(int)}]{w}
\item[{height:(int)}]{h}
\item[{pixelFormat:(C\-C\-Texture2\-D\-Pixel\-Format)}]{format}
\end{DoxyParamCaption}
}}\label{class_c_c_render_texture_a77581a363d799f8809e41af16b065430}
initializes a Render\-Texture object with width and height in Points and a pixel format, only R\-G\-B and R\-G\-B\-A formats are valid 
\begin{DoxyCode}
                   :(int)w height:(int)h pixelFormat:(CCTexture2DPixelFormat)
      format
{
  return [self initWithWidth:w height:h pixelFormat:format depthStencilFormat:0
      ];
}
\end{DoxyCode}
\hypertarget{class_c_c_render_texture_abec7e1e6f1d8364ede1ec35b80e8676b}{\index{C\-C\-Render\-Texture@{C\-C\-Render\-Texture}!init\-With\-Width\-:height\-:pixel\-Format\-:depth\-Stencil\-Format\-:@{init\-With\-Width\-:height\-:pixel\-Format\-:depth\-Stencil\-Format\-:}}
\index{init\-With\-Width\-:height\-:pixel\-Format\-:depth\-Stencil\-Format\-:@{init\-With\-Width\-:height\-:pixel\-Format\-:depth\-Stencil\-Format\-:}!CCRenderTexture@{C\-C\-Render\-Texture}}
\subsubsection[{init\-With\-Width\-:height\-:pixel\-Format\-:depth\-Stencil\-Format\-:}]{\setlength{\rightskip}{0pt plus 5cm}-\/ (id) init\-With\-Width\-: 
\begin{DoxyParamCaption}
\item[{(int)}]{w}
\item[{height:(int)}]{h}
\item[{pixelFormat:(C\-C\-Texture2\-D\-Pixel\-Format)}]{format}
\item[{depthStencilFormat:(G\-Luint)}]{depth\-Stencil\-Format}
\end{DoxyParamCaption}
}}\label{class_c_c_render_texture_abec7e1e6f1d8364ede1ec35b80e8676b}
initializes a Render\-Texture object with width and height in Points and a pixel format( only R\-G\-B and R\-G\-B\-A formats are valid ) and depth\-Stencil format 

Referenced by init\-With\-Width\-:height\-:pixel\-Format\-:.


\begin{DoxyCode}
                  :(int)w height:(int)h pixelFormat:(CCTexture2DPixelFormat) 
      format depthStencilFormat:(GLuint)depthStencilFormat
{
        if ((self = [super init]))
        {
                NSAssert(format != kCCTexture2DPixelFormat_A8,@"only RGB and
       RGBA formats are valid for a render texture");

                CCDirector *director = [CCDirector sharedDirector];

                // XXX multithread
                if( [director runningThread] != [NSThread currentThread] )
                        CCLOGWARN(@"cocos2d: WARNING. CCRenderTexture is
       running on its own thread. Make sure that an OpenGL context is being used on this
       thread!");

                
                w *= CC_CONTENT_SCALE_FACTOR();
                h *= CC_CONTENT_SCALE_FACTOR();

                glGetIntegerv(GL_FRAMEBUFFER_BINDING, &oldFBO_);

                // textures must be power of two
                NSUInteger powW;
                NSUInteger powH;

                if( [[CCConfiguration sharedConfiguration] supportsNPOT] ) {
                        powW = w;
                        powH = h;
                } else {
                        powW = ccNextPOT(w);
                        powH = ccNextPOT(h);
                }

                void *data = malloc((int)(powW * powH * 4));
                memset(data, 0, (int)(powW * powH * 4));
                pixelFormat_=format;

                texture_ = [[CCTexture2D alloc] initWithData:data pixelFormat:
      pixelFormat_ pixelsWide:powW pixelsHigh:powH contentSize:CGSizeMake(w, h)];
                free( data );

                GLint oldRBO;
                glGetIntegerv(GL_RENDERBUFFER_BINDING, &oldRBO);

                // generate FBO
                glGenFramebuffers(1, &fbo_);
                glBindFramebuffer(GL_FRAMEBUFFER, fbo_);

                // associate texture with FBO
                glFramebufferTexture2D(GL_FRAMEBUFFER, GL_COLOR_ATTACHMENT0, 
      GL_TEXTURE_2D, texture_.name, 0);

                if (depthStencilFormat != 0) {
                        //create and attach depth buffer
                        glGenRenderbuffers(1, &depthRenderBufffer_);
                        glBindRenderbuffer(GL_RENDERBUFFER, depthRenderBufffer_
      );
                        glRenderbufferStorage(GL_RENDERBUFFER, 
      depthStencilFormat, (GLsizei)powW, (GLsizei)powH);
                        glFramebufferRenderbuffer(GL_FRAMEBUFFER, 
      GL_DEPTH_ATTACHMENT, GL_RENDERBUFFER, depthRenderBufffer_);

                        // if depth format is the one with stencil part, bind
       same render buffer as stencil attachment
                        if (depthStencilFormat == GL_DEPTH24_STENCIL8)
                                glFramebufferRenderbuffer(GL_FRAMEBUFFER, 
      GL_STENCIL_ATTACHMENT, GL_RENDERBUFFER, depthRenderBufffer_);
                }

                // check if it worked (probably worth doing :) )
                NSAssert( glCheckFramebufferStatus(GL_FRAMEBUFFER) == 
      GL_FRAMEBUFFER_COMPLETE, @"Could not attach texture to framebuffer");

                [texture_ setAliasTexParameters];

                // retained
                self.sprite = [CCSprite spriteWithTexture:texture_];

                [texture_ release];
                [sprite_ setScaleY:-1];

                // issue #937
                [sprite_ setBlendFunc:(ccBlendFunc){GL_ONE, 
      GL_ONE_MINUS_SRC_ALPHA}];

                glBindRenderbuffer(GL_RENDERBUFFER, oldRBO);
                glBindFramebuffer(GL_FRAMEBUFFER, oldFBO_);
                
                // Diabled by default.
                autoDraw_ = NO;
                
                // add sprite for backward compatibility
                [self addChild:sprite_];
        }
        return self;
}
\end{DoxyCode}
\hypertarget{class_c_c_render_texture_a7fd1516f97823568c33872227a859336}{\index{C\-C\-Render\-Texture@{C\-C\-Render\-Texture}!render\-Texture\-With\-Width\-:height\-:@{render\-Texture\-With\-Width\-:height\-:}}
\index{render\-Texture\-With\-Width\-:height\-:@{render\-Texture\-With\-Width\-:height\-:}!CCRenderTexture@{C\-C\-Render\-Texture}}
\subsubsection[{render\-Texture\-With\-Width\-:height\-:}]{\setlength{\rightskip}{0pt plus 5cm}+ (id) render\-Texture\-With\-Width\-: 
\begin{DoxyParamCaption}
\item[{(int)}]{w}
\item[{height:(int)}]{h}
\end{DoxyParamCaption}
}}\label{class_c_c_render_texture_a7fd1516f97823568c33872227a859336}
creates a Render\-Texture object with width and height in Points, pixel format is R\-G\-B\-A8888 
\begin{DoxyCode}
                           :(int)w height:(int)h
{
        return [[[self alloc] initWithWidth:w height:h pixelFormat:
      kCCTexture2DPixelFormat_RGBA8888 depthStencilFormat:0] autorelease];
}
\end{DoxyCode}
\hypertarget{class_c_c_render_texture_a6f38823a12f4eaab8246ef55c66fea81}{\index{C\-C\-Render\-Texture@{C\-C\-Render\-Texture}!render\-Texture\-With\-Width\-:height\-:pixel\-Format\-:@{render\-Texture\-With\-Width\-:height\-:pixel\-Format\-:}}
\index{render\-Texture\-With\-Width\-:height\-:pixel\-Format\-:@{render\-Texture\-With\-Width\-:height\-:pixel\-Format\-:}!CCRenderTexture@{C\-C\-Render\-Texture}}
\subsubsection[{render\-Texture\-With\-Width\-:height\-:pixel\-Format\-:}]{\setlength{\rightskip}{0pt plus 5cm}+ (id) render\-Texture\-With\-Width\-: 
\begin{DoxyParamCaption}
\item[{(int)}]{w}
\item[{height:(int)}]{h}
\item[{pixelFormat:(C\-C\-Texture2\-D\-Pixel\-Format)}]{format}
\end{DoxyParamCaption}
}}\label{class_c_c_render_texture_a6f38823a12f4eaab8246ef55c66fea81}
creates a Render\-Texture object with width and height in Points and a pixel format, only R\-G\-B and R\-G\-B\-A formats are valid 
\begin{DoxyCode}
                           :(int)w height:(int)h pixelFormat:(
      CCTexture2DPixelFormat) format
{
        return [[[self alloc] initWithWidth:w height:h pixelFormat:format] 
      autorelease];
}
\end{DoxyCode}
\hypertarget{class_c_c_render_texture_ae93eca7af88866612ea3eba0dc580e9a}{\index{C\-C\-Render\-Texture@{C\-C\-Render\-Texture}!render\-Texture\-With\-Width\-:height\-:pixel\-Format\-:depth\-Stencil\-Format\-:@{render\-Texture\-With\-Width\-:height\-:pixel\-Format\-:depth\-Stencil\-Format\-:}}
\index{render\-Texture\-With\-Width\-:height\-:pixel\-Format\-:depth\-Stencil\-Format\-:@{render\-Texture\-With\-Width\-:height\-:pixel\-Format\-:depth\-Stencil\-Format\-:}!CCRenderTexture@{C\-C\-Render\-Texture}}
\subsubsection[{render\-Texture\-With\-Width\-:height\-:pixel\-Format\-:depth\-Stencil\-Format\-:}]{\setlength{\rightskip}{0pt plus 5cm}+ (id) render\-Texture\-With\-Width\-: 
\begin{DoxyParamCaption}
\item[{(int)}]{w}
\item[{height:(int)}]{h}
\item[{pixelFormat:(C\-C\-Texture2\-D\-Pixel\-Format)}]{format}
\item[{depthStencilFormat:(G\-Luint)}]{depth\-Stencil\-Format}
\end{DoxyParamCaption}
}}\label{class_c_c_render_texture_ae93eca7af88866612ea3eba0dc580e9a}
initializes a Render\-Texture object with width and height in Points and a pixel format( only R\-G\-B and R\-G\-B\-A formats are valid ) and depth\-Stencil format 
\begin{DoxyCode}
                           :(int)w height:(int)h pixelFormat:(
      CCTexture2DPixelFormat) format depthStencilFormat:(GLuint)depthStencilFormat
{
  return [[[self alloc] initWithWidth:w height:h pixelFormat:format 
      depthStencilFormat:depthStencilFormat] autorelease];
}
\end{DoxyCode}
\hypertarget{class_c_c_render_texture_a6c6c723493a1ec9578b2ca4f27774ee7}{\index{C\-C\-Render\-Texture@{C\-C\-Render\-Texture}!save\-To\-File\-:@{save\-To\-File\-:}}
\index{save\-To\-File\-:@{save\-To\-File\-:}!CCRenderTexture@{C\-C\-Render\-Texture}}
\subsubsection[{save\-To\-File\-:}]{\setlength{\rightskip}{0pt plus 5cm}-\/ (B\-O\-O\-L) {\bf save\-To\-File\-:} 
\begin{DoxyParamCaption}
\item[{(N\-S\-String$\ast$)}]{name}
\end{DoxyParamCaption}
}}\label{class_c_c_render_texture_a6c6c723493a1ec9578b2ca4f27774ee7}
saves the texture into a file using J\-P\-E\-G format. The file will be saved in the Documents folder. Returns Y\-E\-S if the operation is successful. 
\begin{DoxyCode}
                  :(NSString*)name
{
        return [self saveToFile:name format:kCCImageFormatJPEG];
}
\end{DoxyCode}
\hypertarget{class_c_c_render_texture_aad1bc8417cce99a3d936edb4e1a302b1}{\index{C\-C\-Render\-Texture@{C\-C\-Render\-Texture}!save\-To\-File\-:format\-:@{save\-To\-File\-:format\-:}}
\index{save\-To\-File\-:format\-:@{save\-To\-File\-:format\-:}!CCRenderTexture@{C\-C\-Render\-Texture}}
\subsubsection[{save\-To\-File\-:format\-:}]{\setlength{\rightskip}{0pt plus 5cm}-\/ (B\-O\-O\-L) {\bf save\-To\-File\-:} 
\begin{DoxyParamCaption}
\item[{(N\-S\-String$\ast$)}]{name}
\item[{format:(t\-C\-C\-Image\-Format)}]{format}
\end{DoxyParamCaption}
}}\label{class_c_c_render_texture_aad1bc8417cce99a3d936edb4e1a302b1}
saves the texture into a file. The format could be J\-P\-G or P\-N\-G. The file will be saved in the Documents folder. Returns Y\-E\-S if the operation is successful. 

Referenced by save\-To\-File\-:.


\begin{DoxyCode}
                 :(NSString*)fileName format:(tCCImageFormat)format
{
        BOOL success;
        
        NSString *fullPath = [[NSSearchPathForDirectoriesInDomains(
      NSDocumentDirectory, NSUserDomainMask, YES) objectAtIndex:0] stringByAppendingPathComponent:
      fileName];
        
        CGImageRef imageRef = [self newCGImage];

        if( ! imageRef ) {
                CCLOG(@"cocos2d: Error: Cannot create CGImage ref from texture"
      );
                return NO;
        }
        
#if __CC_PLATFORM_IOS
        
        UIImage* image  = [[UIImage alloc] initWithCGImage:imageRef scale:
      CC_CONTENT_SCALE_FACTOR() orientation:UIImageOrientationUp];
        NSData *imageData = nil;

        if( format == kCCImageFormatPNG )
                imageData = UIImagePNGRepresentation( image );

        else if( format == kCCImageFormatJPEG )
                imageData = UIImageJPEGRepresentation(image, 0.9f);

        else
                NSAssert(NO, @"Unsupported format");
        
        [image release];

        success = [imageData writeToFile:fullPath atomically:YES];

        
#elif __CC_PLATFORM_MAC
        
        CFURLRef url = (CFURLRef)[NSURL fileURLWithPath:fullPath];
        
        CGImageDestinationRef dest;

        if( format == kCCImageFormatPNG )
                dest =  CGImageDestinationCreateWithURL(url, kUTTypePNG, 1, 
      NULL);

        else if( format == kCCImageFormatJPEG )
                dest =  CGImageDestinationCreateWithURL(url, kUTTypeJPEG, 1, 
      NULL);

        else
                NSAssert(NO, @"Unsupported format");

        CGImageDestinationAddImage(dest, imageRef, nil);
                
        success = CGImageDestinationFinalize(dest);

        CFRelease(dest);
#endif

        CGImageRelease(imageRef);
        
        if( ! success )
                CCLOG(@"cocos2d: ERROR: Failed to save file:%@ to disk",
      fullPath);

        return success;
}
\end{DoxyCode}


\subsection{Property Documentation}
\hypertarget{class_c_c_render_texture_a74d13404d368796b39f69f320faee52b}{\index{C\-C\-Render\-Texture@{C\-C\-Render\-Texture}!auto\-Draw@{auto\-Draw}}
\index{auto\-Draw@{auto\-Draw}!CCRenderTexture@{C\-C\-Render\-Texture}}
\subsubsection[{auto\-Draw}]{\setlength{\rightskip}{0pt plus 5cm}-\/ (B\-O\-O\-L) {\bf auto\-Draw}\hspace{0.3cm}{\ttfamily  \mbox{[}read, write, assign\mbox{]}}}}\label{class_c_c_render_texture_a74d13404d368796b39f69f320faee52b}
When enabled, it will render its children into the texture automatically. Disabled by default for compatiblity reasons. Will be enabled in the future. \hypertarget{class_c_c_render_texture_acd634a88dca082fc15cec37b06aac438}{\index{C\-C\-Render\-Texture@{C\-C\-Render\-Texture}!clear\-Color@{clear\-Color}}
\index{clear\-Color@{clear\-Color}!CCRenderTexture@{C\-C\-Render\-Texture}}
\subsubsection[{clear\-Color}]{\setlength{\rightskip}{0pt plus 5cm}-\/ ({\bf cc\-Color4\-F}) {\bf clear\-Color}\hspace{0.3cm}{\ttfamily  \mbox{[}read, write, assign\mbox{]}}}}\label{class_c_c_render_texture_acd634a88dca082fc15cec37b06aac438}
Clear color value. Valid only when \char`\"{}auto\-Draw\char`\"{} is Y\-E\-S. \hypertarget{class_c_c_render_texture_af79356a17a6760f9f6167d5444cf6b77}{\index{C\-C\-Render\-Texture@{C\-C\-Render\-Texture}!clear\-Depth@{clear\-Depth}}
\index{clear\-Depth@{clear\-Depth}!CCRenderTexture@{C\-C\-Render\-Texture}}
\subsubsection[{clear\-Depth}]{\setlength{\rightskip}{0pt plus 5cm}-\/ (G\-Lclampf) {\bf clear\-Depth}\hspace{0.3cm}{\ttfamily  \mbox{[}read, write, assign\mbox{]}}}}\label{class_c_c_render_texture_af79356a17a6760f9f6167d5444cf6b77}
Value for clear\-Depth. Valid only when auto\-Draw is Y\-E\-S. \hypertarget{class_c_c_render_texture_af0a421c5fee6668cbfbb8386d002af41}{\index{C\-C\-Render\-Texture@{C\-C\-Render\-Texture}!clear\-Flags@{clear\-Flags}}
\index{clear\-Flags@{clear\-Flags}!CCRenderTexture@{C\-C\-Render\-Texture}}
\subsubsection[{clear\-Flags}]{\setlength{\rightskip}{0pt plus 5cm}-\/ (G\-Lbitfield) {\bf clear\-Flags}\hspace{0.3cm}{\ttfamily  \mbox{[}read, write, assign\mbox{]}}}}\label{class_c_c_render_texture_af0a421c5fee6668cbfbb8386d002af41}
Valid flags\-: G\-L\-\_\-\-C\-O\-L\-O\-R\-\_\-\-B\-U\-F\-F\-E\-R\-\_\-\-B\-I\-T, G\-L\-\_\-\-D\-E\-P\-T\-H\-\_\-\-B\-U\-F\-F\-E\-R\-\_\-\-B\-I\-T, G\-L\-\_\-\-S\-T\-E\-N\-C\-I\-L\-\_\-\-B\-U\-F\-F\-E\-R\-\_\-\-B\-I\-T. They can be O\-R'ed. Valid when "auto\-Draw is Y\-E\-S. \hypertarget{class_c_c_render_texture_a715880e5dc695f243e3ce08b3f8dd09d}{\index{C\-C\-Render\-Texture@{C\-C\-Render\-Texture}!clear\-Stencil@{clear\-Stencil}}
\index{clear\-Stencil@{clear\-Stencil}!CCRenderTexture@{C\-C\-Render\-Texture}}
\subsubsection[{clear\-Stencil}]{\setlength{\rightskip}{0pt plus 5cm}-\/ (G\-Lint) {\bf clear\-Stencil}\hspace{0.3cm}{\ttfamily  \mbox{[}read, write, assign\mbox{]}}}}\label{class_c_c_render_texture_a715880e5dc695f243e3ce08b3f8dd09d}
Value for clear Stencil. Valid only when auto\-Draw is Y\-E\-S \hypertarget{class_c_c_render_texture_a1e77dcd25e60ceb47d423854eab9c2b7}{\index{C\-C\-Render\-Texture@{C\-C\-Render\-Texture}!sprite@{sprite}}
\index{sprite@{sprite}!CCRenderTexture@{C\-C\-Render\-Texture}}
\subsubsection[{sprite}]{\setlength{\rightskip}{0pt plus 5cm}-\/ ({\bf C\-C\-Sprite}$\ast$) {\bf sprite}\hspace{0.3cm}{\ttfamily  \mbox{[}read, write, retain\mbox{]}}}}\label{class_c_c_render_texture_a1e77dcd25e60ceb47d423854eab9c2b7}
The \hyperlink{class_c_c_sprite}{C\-C\-Sprite} being used. The sprite, by default, will use the following blending function\-: G\-L\-\_\-\-O\-N\-E, G\-L\-\_\-\-O\-N\-E\-\_\-\-M\-I\-N\-U\-S\-\_\-\-S\-R\-C\-\_\-\-A\-L\-P\-H\-A. The blending function can be changed in runtime by calling\-:
\begin{DoxyItemize}
\item \mbox{[}\mbox{[}render\-Texture sprite\mbox{]} set\-Blend\-Func\-:(cc\-Blend\-Func)\{G\-L\-\_\-\-O\-N\-E, G\-L\-\_\-\-O\-N\-E\-\_\-\-M\-I\-N\-U\-S\-\_\-\-S\-R\-C\-\_\-\-A\-L\-P\-H\-A\}\mbox{]}; 
\end{DoxyItemize}

The documentation for this class was generated from the following files\-:\begin{DoxyCompactItemize}
\item 
/\-Bing/\-File/cocos2d/cocos2d-\/iphone/cocos2d-\/iphone-\/2.\-1-\/beta4/cocos2d/cc\-Deprecated.\-m\item 
/\-Bing/\-File/cocos2d/cocos2d-\/iphone/cocos2d-\/iphone-\/2.\-1-\/beta4/cocos2d/C\-C\-Render\-Texture.\-h\item 
/\-Bing/\-File/cocos2d/cocos2d-\/iphone/cocos2d-\/iphone-\/2.\-1-\/beta4/cocos2d/C\-C\-Render\-Texture.\-m\end{DoxyCompactItemize}
